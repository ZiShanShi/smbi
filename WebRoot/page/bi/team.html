<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>团队管理</title>
		<link href="../../css/team.css" rel="stylesheet">
		<link href="../../css/control.css" rel="stylesheet">
		<link href="../../css/jquery-ui.min.css" rel="stylesheet">
		<link href="../../css/jquery.multiselect.css" rel="stylesheet">
		
		<script type="text/javascript" src="../../js/jquery1.8.min.js" ></script>
		<script type="text/javascript" src="../../js/foundation-2.0.js" ></script>
		<script type="text/javascript" src="../../js/control.js" ></script>
		<script type="text/javascript" src="../../js/echarts.min.3.8.5.js" ></script>
		<script type="text/javascript" src="../../js/random.js" ></script>
		<script type="text/javascript" src="../../data/team.js" ></script>
		<script type="text/javascript" src="../../option/team.js" ></script>
		<script type="text/javascript" src="../../js/jquery-ui-1.10.4.js" ></script>
		<script type="text/javascript" src="../../js/jquery.multiselect.js" ></script>
		
	</head>
	
	<script>
		//changeOption(middleOption, "series[0];data[0];value", 140);

        function resetScatter() {
            var filter = getHeaderFilter();
            var user = getLocalData("user");
            var topicCode = "achieve";

            var dataname = "getTeamAchieveDetail";

            var chartInstance = echarts.getInstanceByDom(document.getElementById("scatter"));

            var params = "code=" + topicCode + "&userType="+user.type + "&userId=" + user.name;

            if(dataname) {
                params += "&dataName=" + dataname;
            }
            var dataType = "sellin";

            if (dataType) {
                params += "&dataType=" + dataType;
			}
            if(filter) {
                params += "&filter=" + filter;
            }

            chartInstance.showLoading('default', {text:'获取中..'});
            Server.call("root/bi/data", params, function (result) {
                if(!result) {
                    return;
                }
                var option = chartInstance.getOption();
                var optionData =new Array();

                for(var i = 0; i < result.name.length; i++) {
                    var oneData = new Array();
                    oneData[0] = result.achieve[i];
                    oneData[1] = result.growth[i];
                    oneData[2] = parseInt(result.ytd[i])/1000;
                    oneData[3] = result.name[i];
                    optionData[i] = oneData;
				}
				option.series[0].data = optionData;
                var opt = JSON.stringify(option);
                chartInstance.setOption(option);
                chartInstance.hideLoading();
            });
        }

        function chartRefresh() {
            for(var i = 0; i <topicMap.length; i++) {
                var one = topicMap[i];
                resetChartData(one);
            }
            resetScatter();
        }

		var teamachieveOption = clone(middleOption);

        $(document).ready(function(){
		var teamachieveChart = echarts.init(document.getElementById("teamachieve"));
        teamachieveChart.setOption(teamachieveOption);

		var scatterChart = echarts.init(document.getElementById("scatter"));
        scatterChart.setOption(scatterOption);

		var businessrankChart = echarts.init(document.getElementById("businessrank"));
        businessrankChart.setOption(businessrank);
        
        var salerankChart = echarts.init(document.getElementById("salerank"));
        salerankChart.setOption(salerank);
        
			
		$("#brand").multiselect({
					selectedList: 4,
					multiple:true,
					header:true,
			 	  close:function(event, ui){
			 	  	var selects = $("#brand").multiselect("getChecked");
			 	  		for(var i = 0; i < selects.length; i++) {
			 	  			var one = selects[i];
			 	  			var vale = $(one).val();
			 	  		}
			 	  } 
			 });

			 $("#year").multiselect({});
			 $("#quarter").multiselect({
			 	close:function(event, ui){
			 	  	var selects = $("#quarter").multiselect("getChecked")[0];
			 	  	var quarter = $(selects).val();
			 	  	if("all" == quarter) {
			 	  		//todo
			 	  	}else {
				 	  	monthselect.empty();
				 	  	 var allopt = $('<option />', {
							value: 'All',
							text: 'All'
						 });
				 	  	allopt.appendTo(monthselect);
				 	  	var start = (quarter - 1) <0? 0 : (quarter - 1);
						for(var i = start*3; i < quarter*3; i++) {
						 
						 var opt = $('<option />', {
							value: i + 1,
							text: i + 1
						 });
							opt.appendTo(monthselect);
							
						}
						monthselect.multiselect('refresh');
			 	  	}
			 	  				 	  	
			 	  } 
			 });
			 monthselect = $("#month").multiselect({});
			 
			 var superv = $("#superv").multiselect({
			 minWidth:120});
			 
			 $("#brand").multiselect("uncheckAll"); 

			 $("#superv").multiselect("uncheckAll"); 


            initCommonMutiSelect();

        	$(window).bind('resize',resizeChart);
            initPeroidMonth();

            /*$("#product").multiselect({
                selectedList: 4,
                multiple:true,
                header:true,
                close:function(event, ui){
                    var selects = $("#brand").multiselect("getChecked");
                    for(var i = 0; i < selects.length; i++) {
                        var one = selects[i];
                        var vale = $(one).val();
                    }
                }
            });

            $("#product").multiselect("uncheckAll");*/
        });
	</script>
	
	<body style="margin: 0;">
		<div class="left-top">
			<div class="panel-inner">
				<div class="title-img">
					<img src="../../image/report-color.png" width="24">
				</div>
				<div class="title">团队销售达成</div>
				<div class="subtitle" style="">Target：<b id="saletarget">65648.49</b>k</div>
				<div class="subtitle" style="top: 22%;">YTD：<b id="salereal">91727.68</b>k</div>
				<div class="middle-cricle" >
					<div id="teamachieve" style="height: 100%;width: 100%;"></div>
				</div>			
			</div>
		
		</div>
		
		<div class="left-bottom">
			<div  class="panel-inner">
				<div class="title-img">
					<img src="../../image/report-color.png" width="24">
				</div>
				<div class="title">sellin</div>
			</div>
			<div class="chartarea" id="businessrank"></div>
			<!--<div class = "details-bottom" onclick="changetab('../bi/selloutkpi.html',1,2)">&nbsp;&gt;&gt;&nbsp;明细&nbsp;&nbsp;</div>
-->
		</div>
		
		<div class="right-top">
		<div  class="panel-inner">
			<div class="title-img">
				<img src="../../image/report-color.png" width="24">
			</div>
			<div class="title">团队达成增长散点图</div>
		</div>
		<div id="scatter" class="chartarea"></div>
		</div>
		
		
		<div class="right-bottom">
			<div  class="panel-inner">
				<div class="title-img">
					<img src="../../image/report-color.png" width="24">
				</div>
				<div class = "periodselectdiv" style="left:60%">
		
					<div style="float: left;">主管：</div>
					<select id="superv" class="periodselect" style="width:80px;">
						<option>east</option>
						<option>south</option>
						<option>west</option>
						<option>north</option>
						<option>northeast</option>
					</select>
				</div>
				<div class="title">sellout</div>
			</div>
			<div class="chartarea" id="salerank"></div>
			<!--<div class = "details-bottom" onclick="changetab('../bi/selloutkpi.html',1,3)">&nbsp;&gt;&gt;&nbsp;明细&nbsp;&nbsp;</div>
			-->
		</div>
		
		<div class="periodselectdiv ">
		<div style="float: left;">年：
				<select id="year" class="periodselect">
					<option>2017</option>
					<option selected="selected">2018</option>
					<option>2019</option>
					<option>2020</option>
				</select>
				</div>
				<div style="float: left;">季度：
				<select id="quarter" class="periodselect">
					<option value="1">Q1</option>
					<option value="2">Q2</option>
					<option value="3">Q3</option>
					<option value="4">Q4</option>
				</select>
				</div>
					<div style="float: left;">月份：
				<select id="month" class="periodselect">
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
					<option value="7">7</option>
					<option value="8">8</option>
					<option value="9">9</option>
					<option value="10">10</option>
					<option value="11">11</option>
					<option value="12">12</option>
				</select>
				</div>
				<div style="float: left;">产品线：
					<select id="brand"  class="periodselect" >
						<option value="Straumann">士卓曼</option>
						<option value="Anthogyr">安卓健</option>
						<option value="Tplus">T-plus</option>
					</select>
				</div>
		<!--<div style="float: left;">产品：
		<select id="product" class="periodselect">
			<option selected="selected">牙科种植体</option>
			<option>骨水平种植体</option>
			<option>基台</option>
		</select>
		</div>-->
	</div>
	</body>
	
</html>
